<div class="row">
  <h2 [class.col-9]="user !== null" [class.col-12]="user === null">Team #{{ (team?.teamNumber) ? team.teamNumber : teamKey }}</h2>
  <div *ngIf="user !== null" class="col-12 col-md-3">
    <button mdc-button primary raised (click)="toggleTeam()" class="align-self-end icon-white text-white w-100" style="text-transform:initial; height: auto; padding: 5px">
      <mdc-icon *ngIf="favorite" class="mr-1">favorite</mdc-icon>
      <mdc-icon *ngIf="!favorite" class="mr-1">favorite_border</mdc-icon>
      {{ favorite ? 'Remove from myTOA' : 'Add to myTOA' }}</button>
  </div>
</div>


<div class="row mt-3" *ngIf="team">
  <div class="col-xs-12 col-sm-3 col-lg-3 pb-5">
    <mdc-card class="toa-card">
      <div class="w-100 p-3">
        <div *ngIf="seasons && team.rookieYear" class="dropdown">
          <button *ngIf="currentSeason" class="btn btn-default dropdown-toggle" type="button" id="ftc_season" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            {{ getSeasonString(currentSeason.seasonKey)}}
            <span class="caret"></span>
          </button>

          <ul class="dropdown-menu" aria-labelledby="ftc_season">
            <mdc-list-item *ngFor="let season of seasons" (click)="selectSeason(season)">{{ getSeasonString(season.seasonKey)}}</mdc-list-item>
          </ul>
        </div>

        <ul *ngIf="team.events" class="nav flex-column mt-2" style="padding-left: 0.75rem">
          <li class="nav-item">
            <a href="teams/{{ team.teamKey }}#info">Team Info</a>
          </li>
          <li class="nav-item mt-1">
            Event Results
            <ul class="nav flex-column">
              <li class="nav-item"><a *ngFor="let event of team.events" (click)="scrollToEvent(event.eventKey)" class="nav-link">{{ event.divisionName ? event.eventName + ' - ' + event.divisionName + ' Division' : event.eventName}}</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </mdc-card>
  </div>

  <div class="col-xs-12 col-sm-9 col-lg-9">
    <mdc-card class="toa-card" id="info">
      <div class="toa-card-header" [class.pb-1]="team.teamNameLong" mdcHeadline5>#{{ team.teamNumber }} - {{ team.teamNameShort }}</div>
      <div class="toa-card-subtitle pt-0" *ngIf="team.teamNameLong">{{ team.teamNameLong }}</div>
      <mdc-list-divider></mdc-list-divider>
      <div class="p-3">
        <div class="info-state d-flex align-content-center flex-wrap">
          <mdc-icon svgIcon="compass"></mdc-icon>
          <p>Part of the {{ team.regionKey }} Region</p>
        </div>

        <div class="info-state d-flex align-content-center flex-wrap">
          <mdc-icon svgIcon="map-marker"></mdc-icon>
          <p style="text-transform: capitalize"><a href="https://www.google.com/maps/search/?api=1&query={{ (team.city + ', ' + (team.stateProv ? team.stateProv + ', ' : '') + team.country).replace(' ', '+') }}" target="_blank">{{ team.city + ', ' + (team.stateProv ? team.stateProv + ', ' : '') + team.country }}</a></p>
        </div>

        <div class="info-state d-flex align-content-center flex-wrap" *ngIf="team.website && beautifulURL(team.website).startsWith('www.facebook.com/')">
          <mdc-icon svgIcon="facebook"></mdc-icon>
          <p>Facebook: <a href="{{ team.website }}">@{{ beautifulURL(team.website).replace("www.facebook.com/", "") }}</a></p>
        </div>

        <div class="info-state d-flex align-content-center flex-wrap" *ngIf="team.website && !beautifulURL(team.website).startsWith('www.facebook.com/')">
          <mdc-icon svgIcon="earth"></mdc-icon>
          <p>Website: <a href="{{ team.website }}">{{ beautifulURL(team.website) }}</a></p>
        </div>

        <div class="info-state d-flex align-content-center flex-wrap" *ngIf="team.robotName">
          <mdc-icon svgIcon="robot"></mdc-icon>
          <p>Robot Name: {{ team.robotName }}</p>
        </div>

        <div class="info-state d-flex align-content-center flex-wrap" *ngIf="team.rookieYear && team.rookieYear !== 0">
          <mdc-icon svgIcon="airballoon"></mdc-icon>
          <p>Rookie Year: {{ team.rookieYear }}</p>
        </div>

        <div class="info-state d-flex align-content-center flex-wrap" *ngIf="team.lastActive < 1819">
          <mdc-icon svgIcon="clock-end"></mdc-icon>
          <p>Last Active Season: {{ getSeasonString(team.lastActive) }}</p>
        </div>

        <div class="info-state d-flex align-content-center flex-wrap" *ngIf="team.awards && currentSeason && currentSeason.description">
          <mdc-icon svgIcon="trophy"></mdc-icon>
          <p>{{ team.awards.length }} awards in {{ currentSeason.description }}</p>
        </div>
      </div>
    </mdc-card>

    <div *ngIf="team.events">
      <h1 class="pt-5 pb-1" mdcHeadline5>Event Results</h1>
      <div *ngFor="let event of team.events" id="{{ event.eventKey }}" class="col-xs-12 pb-4">
        <mdc-card class="toa-card">
          <a class="toa-card-header pb-0" routerLink="/events/{{ event.eventKey }}" mdcHeadline5>{{ event.divisionName ? event.eventName + ' - ' + event.divisionName + ' Division' : event.eventName}}</a>
          <div class="toa-card-subtitle pt-0" mdcSubtitle2>{{ event.city }}, {{ event.stateProv ? event.stateProv + ', ' : ''}}{{ event.country }} on {{ event.startDate | date :  "mediumDate"}}</div>

          <mdc-list-divider></mdc-list-divider>

          <div class="p-3">
            <div *ngIf="event.rankings && event.rankings.length > 0">
              <p><b>Qual Rank #{{ event.rankings[0].rank }}</b> with a record of <b>{{ event.rankings[0].wins }}-{{ event.rankings[0].losses }}-{{ event.rankings[0].ties }}</b></p>
            </div>
            <div *ngIf="event.awards && event.awards.length > 0">
              <p><b>{{event.awards.length }} Awards:</b></p>
              <ul>
                <li *ngFor="let award of event.awards">{{ award.awardName }}</li>
              </ul>
            </div>
            <match-table [matchList]="event.matches" [team]="team"></match-table>
          </div>
        </mdc-card>
      </div>

      <small><strong>Bold</strong> is Winning Alliance</small><br>
      <small><strong>Bold and Black</strong> is Selected Team</small><br>
      <small>* is Surrogate match for that team</small><br>
      <small>Empty is team was DQ or no-show</small>
    </div>
  </div>
</div>
